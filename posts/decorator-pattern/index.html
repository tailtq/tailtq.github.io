<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Decorator - A pattern that is ubiquitously used in Python" /><meta name="author" content="Tai Le" /><meta property="og:locale" content="en_US" /><meta name="description" content="Besides using the Bridge pattern, developers should also use Decorator to reduce the complexity of our code. Adapter, Bridge, and Decorator are from the same family but are used for different purposes. Adapter helps us convert an object’s interface to an appropriate form before using it in the intended methods. Bridge helps separate a big class into smaller ones. Decorator helps add new logic without modifying the current class." /><meta property="og:description" content="Besides using the Bridge pattern, developers should also use Decorator to reduce the complexity of our code. Adapter, Bridge, and Decorator are from the same family but are used for different purposes. Adapter helps us convert an object’s interface to an appropriate form before using it in the intended methods. Bridge helps separate a big class into smaller ones. Decorator helps add new logic without modifying the current class." /><link rel="canonical" href="https://tailtq.github.io/posts/decorator-pattern/" /><meta property="og:url" content="https://tailtq.github.io/posts/decorator-pattern/" /><meta property="og:site_name" content="Tailtq" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-05T00:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Decorator - A pattern that is ubiquitously used in Python" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Tai Le" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Tai Le"},"dateModified":"2022-12-05T00:00:00+07:00","datePublished":"2022-12-05T00:00:00+07:00","description":"Besides using the Bridge pattern, developers should also use Decorator to reduce the complexity of our code. Adapter, Bridge, and Decorator are from the same family but are used for different purposes. Adapter helps us convert an object’s interface to an appropriate form before using it in the intended methods. Bridge helps separate a big class into smaller ones. Decorator helps add new logic without modifying the current class.","headline":"Decorator - A pattern that is ubiquitously used in Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://tailtq.github.io/posts/decorator-pattern/"},"url":"https://tailtq.github.io/posts/decorator-pattern/"}</script><title>Decorator - A pattern that is ubiquitously used in Python | Tailtq</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tailtq"><meta name="application-name" content="Tailtq"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-ZB7VQFD7XK"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZB7VQFD7XK'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-right"><div id="avatar"> <a href="/" alt="avatar"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Tailtq</a></div><div class="site-subtitle">A software developer who enjoys learning, reading, and building things</div></div><hr><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <span>Home</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <span>About me</span> </a><li class="nav-item"> <a href="/interesting-blogs/" class="nav-link"> <span>Interesting blogs</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <span>Archives</span> </a><li class="nav-item"> <a href="https://github.com/tailtq" class="nav-link" target="_blank"> <span>GitHub</span> </a><li class="nav-item}"> <a href="https://www.linkedin.com/in/tai-le-05124a187/" class="nav-link" target="_blank"> <span>Linkedin</span> </a></ul></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Decorator - A pattern that is ubiquitously used in Python</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Decorator - A pattern that is ubiquitously used in Python</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Tai Le </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 5, 2022, 12:00 AM +0700" prep="on" > Dec 5, 2022 <i class="unloaded">2022-12-05T00:00:00+07:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1810 words">10 min</span></div></div><div class="post-content"><p>Besides using the Bridge pattern, developers should also use Decorator to reduce the complexity of our code. <strong>Adapter</strong>, <strong>Bridge</strong>, and <strong>Decorator</strong> are from the same family but are used for different purposes. Adapter helps us convert an object’s interface to an appropriate form before using it in the intended methods. Bridge helps separate a big class into smaller ones. Decorator helps add new logic without modifying the current class.</p><p>In today’s post, we will dive into Decorator to see how it really works.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2022-12-05/decorator.png" alt="Decorator Pattern" /> <em>Retrieved from RefactoringGuru</em></p><h2 id="1-definition">1. Definition</h2><p>According to RefactoringGuru, “Decorator is a structural design pattern that lets you attach new behaviors to objects by placing these objects inside special wrapper objects that contain the behaviors”.</p><p>This pattern qualifies the Single Responsibility and Open-Closed principles in SOLID, the object is only responsible for what it currently does and doesn’t allow modifying the code. Instead, Decorator pattern provides a proxy to execute additional new logic before running the main one.</p><h2 id="2-types-of-decorators--examples">2. Types of decorators &amp; examples</h2><p>There are two types of decorators in Python, one is the built-in decorator, and another is writing code like other languages. The native built-in of Python has been widely used in many projects to build packages, libraries, and frameworks such as FastAPI and Django. The second one is heavily OOP-based which is often used in Java, C#, and PHP. We will go through each of them in the following section.</p><h3 id="a-python-native-built-in-decorators">a. Python native built-in decorators</h3><p>Built-in decorators in Python are actually high-order functions that wrap around one function to execute a behavior before or after the execution of that function. You might already hear the term <strong>high-order functions</strong> before, it’s a very popular concept in JavaScript and <a href="https://en.wikipedia.org/wiki/Functional_programming">functional programming</a>. Basically, the decorator is defined by a function that is wrapped by another one, the outer return the inner as the result. The <code class="language-plaintext highlighter-rouge">@</code> must go along as a prefix when using it.</p><p>Please take a look at the code below for further understanding:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">save_log</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># execute saving log code
</span>        <span class="nf">print</span><span class="p">(</span><span class="s">"Saving result to another service..."</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@save_log</span>
<span class="k">def</span> <span class="nf">execute_sql_query</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nf">execute_sql_query</span><span class="p">()</span>
<span class="c1"># Result:
# SQL query is executing...
# Saving result to another service...
</span></pre></table></code></div></div><p>In the example, I added a new behavior which is <code class="language-plaintext highlighter-rouge">save_log</code> without adding additional logic to the <code class="language-plaintext highlighter-rouge">execute_sql_query</code> function, that’s the purpose of decorators. In my perspective, the native built-in is an unextendable approach because it violates some rules in SOLID. However, because of its simplicity and efficiency, many people (including me), frameworks, and libraries are still using it. As people always say, choosing one over another is just a matter of trade-off.</p><h3 id="b-class-based-decorators">b. Class-based decorators</h3><p>Class-based decorators are the more popular type among languages that support OOP. You might have already encountered them in Java, C#, or PHP. Even though their code structure is hard to understand in the beginning, we can combine other OOP practices to make the code clearer and more extendable.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2022-12-05/decorator-class-based.png" alt="Decorator Pattern" /> <em>Retrieved from SourceMaking</em></p><p>Above is the diagram that can help us best understand how we should use the class-based decorator pattern based on the example above. This can be split into 3 parts:</p><ul><li><code class="language-plaintext highlighter-rouge">Interface</code>: define the behavior that every decorator and their wrappee must follow.<li><code class="language-plaintext highlighter-rouge">SQLQuery</code> (wrappee): main executor.<li><code class="language-plaintext highlighter-rouge">Decorators</code> (decorators): define the new behavior that execute before or after the wrappee.</ul><p>As we can see above, <code class="language-plaintext highlighter-rouge">SQLQuery</code> and <code class="language-plaintext highlighter-rouge">Decorators</code> implement the <code class="language-plaintext highlighter-rouge">Interface</code> and each decorator’s <code class="language-plaintext highlighter-rouge">execute</code> method will call <code class="language-plaintext highlighter-rouge">wrappee.execute</code>; therefore, we can easily add new logic before or after calling it. In our previous example, we save the query’s result to a log file. Let’s see how we can implement the SQL querying example above using classes.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>

<span class="c1"># Python doesn't support interface but multiple inheritances, so I'll use class here
# everything should share the same method so objects can be called in a nested way
</span><span class="k">class</span> <span class="nc">Interface</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nc">NotImplementedError</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">SQLQuery</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">BaseSavingLogDecorator</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">wrappee</span><span class="p">:</span> <span class="n">Interface</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">wrappee</span> <span class="o">=</span> <span class="n">wrappee</span>

<span class="k">class</span> <span class="nc">SaveLogDecorator</span><span class="p">(</span><span class="n">BaseSavingLogDecorator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wrappee</span><span class="p">.</span><span class="nf">execute</span><span class="p">()</span>
        <span class="c1"># execute saving log code
</span>        <span class="nf">print</span><span class="p">(</span><span class="s">"Saving result to another service..."</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="nc">SaveLogDecorator</span><span class="p">(</span><span class="nc">SQLQuery</span><span class="p">()).</span><span class="nf">execute</span><span class="p">()</span>

<span class="c1"># we can also stack each decorator on top of the other
</span><span class="k">class</span> <span class="nc">SaveLogToDatabaseDecorator</span><span class="p">(</span><span class="n">BaseSavingLogDecorator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wrappee</span><span class="p">.</span><span class="nf">execute</span><span class="p">()</span>
        <span class="c1"># execute saving log code
</span>        <span class="nf">print</span><span class="p">(</span><span class="s">"Saving result to database..."</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">SaveLogToTextFileDecorator</span><span class="p">(</span><span class="n">BaseSavingLogDecorator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wrappee</span><span class="p">.</span><span class="nf">execute</span><span class="p">()</span>
        <span class="c1"># execute saving log code
</span>        <span class="nf">print</span><span class="p">(</span><span class="s">"Saving result to a text file..."</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="c1"># nested call
</span><span class="nc">SaveLogToTextFileDecorator</span><span class="p">(</span><span class="nc">SaveLogToDatabaseDecorator</span><span class="p">(</span><span class="nc">SQLQuery</span><span class="p">())).</span><span class="nf">execute</span><span class="p">()</span>
<span class="c1"># Result:
# SQL query is executing...
# Saving result to database...
# Saving result to a text file...
</span></pre></table></code></div></div><p>As you can see above, the order of decorators’ operation is depended on how you stack the objects and whether you decide to call <code class="language-plaintext highlighter-rouge">wrappee.execute</code> before or after executing decorators’ logic, this applies for both class-based decorators and built-in decorators.</p><h2 id="3-dive-deeper-into-built-in-decorators">3. Dive deeper into built-in decorators</h2><p>Before jumping to real-world examples, we should understand a bit more about built-in decorators to make our work more smoothly when we need to use them.</p><h3 id="a-add-arguments-to-decorators">a. Add arguments to decorators</h3><p>Going back to the log-saving example, if we have too many places to store our log, defining one decorator for each place is tedious and hard to manage. It would be great if we can pass a <code class="language-plaintext highlighter-rouge">place_type</code> argument to the general <code class="language-plaintext highlighter-rouge">save_log</code> decorator, and we can use the factory pattern in that decorator. Let’s see how it works.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">save_log_to_database</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Saving result to database..."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_log_to_text_file</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Saving result to a text file..."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_log</span><span class="p">(</span><span class="n">place_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">save_log_func</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">place_type</span> <span class="o">==</span> <span class="s">"database"</span><span class="p">:</span>
        <span class="n">save_log_func</span> <span class="o">=</span> <span class="n">save_log_to_database</span>
    <span class="k">elif</span> <span class="n">place_type</span> <span class="o">==</span> <span class="s">"text_file"</span><span class="p">:</span>
        <span class="n">save_log_func</span> <span class="o">=</span> <span class="n">save_log_to_text_file</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">NameError</span><span class="p">(</span><span class="s">"Invalid place_type"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_log_inner</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># execute saving log code
</span>            <span class="nf">save_log_func</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">return</span> <span class="n">save_log_inner</span>

<span class="nd">@save_log</span><span class="p">(</span><span class="s">"text_file"</span><span class="p">)</span>
<span class="nd">@save_log</span><span class="p">(</span><span class="s">"database"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">execute_sql_query</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nf">execute_sql_query</span><span class="p">()</span>
<span class="c1"># Result:
# SQL query is executing...
# Saving result to database...
# Saving result to a text file...
</span></pre></table></code></div></div><p>Basically, the idea is to <strong>add another layer of function</strong>, which is quite complicated and hard for naming (that’s why I name the inner one pretty badly), the outer one accepts parameters, processes them, and returns the true decorator.</p><h3 id="b-introspection">b. Introspection</h3><p>Introspection in Python is the ability of an object to be aware of its own attributes and methods. It allows objects to query and modify their own structure and contents. It is an important feature of the language as it allows developers to access information about objects at runtime. This is done by using the built-in functions <code class="language-plaintext highlighter-rouge">dir()</code>, <code class="language-plaintext highlighter-rouge">getattr()</code>, <code class="language-plaintext highlighter-rouge">hasattr()</code>, <code class="language-plaintext highlighter-rouge">isinstance()</code>, <code class="language-plaintext highlighter-rouge">type()</code>, and attributes like <code class="language-plaintext highlighter-rouge">__name__</code>. <em>(generated by OpenAI GPT-3 :D)</em></p><p>When using built-in decorators, we will lose the introspection ability and functions’ information because Python would describe the decorator, not the main function itself.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1"># @save_log("text_file")
# @save_log("database")
</span><span class="k">def</span> <span class="nf">execute_sql_query</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nf">print</span><span class="p">(</span><span class="n">execute_sql_query</span><span class="p">,</span> <span class="n">execute_sql_query</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>
<span class="c1"># Result:
# &lt;function execute_sql_query at 0x10f0e9488&gt; execute_sql_query
</span>
<span class="nd">@save_log</span><span class="p">(</span><span class="s">"text_file"</span><span class="p">)</span>
<span class="nd">@save_log</span><span class="p">(</span><span class="s">"database"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">execute_sql_query</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nf">print</span><span class="p">(</span><span class="n">execute_sql_query</span><span class="p">,</span> <span class="n">execute_sql_query</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>
<span class="c1"># Result:
# &lt;function save_log.&lt;locals&gt;.save_log_inner.&lt;locals&gt;.decorator at 0x1088e3598&gt; decorator
</span></pre></table></code></div></div><p>This one will be more dramatic if we try to use quick fixes in our code, aka shortcuts. For example, assuming that we have a cache function that saves every result of multiple functions into memory with the key based on parameters. When data is updated, we have to clear the cache to fetch the new result. So as a quick fix, I intentionally assign <code class="language-plaintext highlighter-rouge">clear_cache</code> to remove the cache of each function.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">clear_cache</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Clearing cache..."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cache</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Setting clear_cache attribute..."</span><span class="p">)</span>
    <span class="nf">setattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s">"clear_cache"</span><span class="p">,</span> <span class="n">clear_cache</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># execute caching
</span>        <span class="nf">print</span><span class="p">(</span><span class="s">"Caching result into memory..."</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@cache</span>
<span class="k">def</span> <span class="nf">execute_sql_query</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nf">execute_sql_query</span><span class="p">()</span>
<span class="n">execute_sql_query</span><span class="p">.</span><span class="nf">clear_cache</span><span class="p">()</span>
<span class="c1"># Result:
# Setting clear_cache attribute...
# SQL query is executing...
# Caching result into memory...
# Traceback (most recent call last):
#   File "test.py", line 27, in &lt;module&gt;
#     execute_sql_query.clear_cache()
# AttributeError: 'function' object has no attribute 'clear_cache'
</span></pre></table></code></div></div><p>So how can we solve this problem? Actually, Python provides the <code class="language-plaintext highlighter-rouge">functools.wraps</code> decorator to update these attributes. Below is the solution, please remember that we must call <code class="language-plaintext highlighter-rouge">@functools.wraps(func)</code> <strong>after</strong> setting the attributes, <strong>not before</strong>.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">functools</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">clear_cache</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Clearing cache..."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cache</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Setting clear_cache attribute..."</span><span class="p">)</span>
    <span class="n">func</span><span class="p">.</span><span class="n">clear_cache</span> <span class="o">=</span> <span class="n">clear_cache</span>

    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># execute caching
</span>        <span class="nf">print</span><span class="p">(</span><span class="s">"Caching result into memory..."</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="c1"># setattr(func, "clear_cache", clear_cache)
</span>
    <span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@cache</span>
<span class="k">def</span> <span class="nf">execute_sql_query</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"SQL query is executing..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nf">execute_sql_query</span><span class="p">()</span>
<span class="n">execute_sql_query</span><span class="p">.</span><span class="nf">clear_cache</span><span class="p">()</span>

<span class="c1"># Result:
# Setting clear_cache attribute...
# SQL query is executing...
# Caching result into memory...
# Clearing cache...
</span></pre></table></code></div></div><h2 id="4-real-world-examples">4. Real-world examples</h2><ul><li><strong>Web Application Frameworks</strong>: Popular web application frameworks such as Flask and Django use decorators to simplify URL routing.<li><strong>Logging</strong>: Python’s logging module provides an easy way to add logging to functions using decorators.<li><strong>Memoization</strong>: Memoization is a technique used to speed up code by caching the results of expensive function calls. This can be done with decorators.<li><strong>Class Decorators</strong>: In Python, classes can also be decorated with decorators. This is often used for adding custom functionality such as class methods and properties.</ul><h2 id="5-references">5. References</h2><ul><li>RefactoringGuru. (n. d.). <em>Decorator</em>. Retrieved from <a href="https://refactoring.guru/design-patterns/decorator">https://refactoring.guru/design-patterns/decorator</a>.<li>SourceMaking. (n. d.). <em>Decorator</em>. Retrieved from <a href="https://sourcemaking.com/design_patterns/decorator">https://sourcemaking.com/design_patterns/decorator</a>.<li>TutorialsPoint. (n. d.). <em>Design Patterns - Decorator Pattern</em>. Retrieved from <a href="https://www.tutorialspoint.com/design_pattern/decorator_pattern.htm">https://www.tutorialspoint.com/design_pattern/decorator_pattern.htm</a>.<li>Hjelle. G. A. (Jan 11, 2015). Primer on Python Decorators. RealPython. Retrieved from <a href="https://realpython.com/primer-on-python-decorators/">https://realpython.com/primer-on-python-decorators/</a>.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >Python</a> <a href="/tags/back-end/" class="post-tag no-text-decoration" >Back-end</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Decorator - A pattern that is ubiquitously used in Python - Tailtq&url=https://tailtq.github.io/posts/decorator-pattern/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Decorator - A pattern that is ubiquitously used in Python - Tailtq&u=https://tailtq.github.io/posts/decorator-pattern/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Decorator - A pattern that is ubiquitously used in Python - Tailtq&url=https://tailtq.github.io/posts/decorator-pattern/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/asynchronous-programming/">Asynchronous Programming</a><li><a href="/posts/streamlit-a-fast-way-to-build-web-applications/">Streamlit - A Fast Way to Build Web Applications</a><li><a href="/posts/modify-facebook-duckling/">Modify Facebook's Duckling</a><li><a href="/posts/tensorflow-with-amd-ubuntu/">Use Tensorflow with AMD GPU on Ubuntu</a><li><a href="/posts/how-i-reduced-rasa-testing-time-by-60-80/">How I reduced RASA testing time by 60-80%</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/back-end/">Back-end</a> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/front-end/">Front-end</a> <a class="post-tag" href="/tags/haskell/">Haskell</a> <a class="post-tag" href="/tags/math/">Math</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/tensorflow/">Tensorflow</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/multithreading-vs-multiprocessing/"><div class="card-body"> <span class="timeago small" > Apr 2, 2022 <i class="unloaded">2022-04-02T00:00:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Multi-threading vs Multi-processing</h3><div class="text-muted small"><p> At some points, we encounter some problems that make our applications tremendously slow. It could be the amount of computation is large, or accessing multiple resources at the time, or too many tas...</p></div></div></a></div><div class="card"> <a href="/posts/caching/"><div class="card-body"> <span class="timeago small" > May 1, 2022 <i class="unloaded">2022-05-01T00:00:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Caching</h3><div class="text-muted small"><p> With an anxious feeling at this moment, I have decided to write a blog article to relieve that feeling. Again, it is all about summarizing things that I have recently worked on, this time is some c...</p></div></div></a></div><div class="card"> <a href="/posts/how-i-reduced-rasa-testing-time-by-60-80/"><div class="card-body"> <span class="timeago small" > Aug 6, 2022 <i class="unloaded">2022-08-06T00:00:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I reduced RASA testing time by 60-80%</h3><div class="text-muted small"><p> It is quite a long time since I wrote my latest post, and now I come back stronger with a topic that contains both Back-end and AI. It is my journey to customize the Natural Language Understanding ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/modify-facebook-duckling/" class="btn btn-outline-primary" prompt="Older"><p>Modify Facebook's Duckling</p></a> <a href="/posts/asynchronous-programming/" class="btn btn-outline-primary" prompt="Newer"><p>Asynchronous Programming</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Tai Le</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/back-end/">Back end</a> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/front-end/">Front end</a> <a class="post-tag" href="/tags/haskell/">Haskell</a> <a class="post-tag" href="/tags/math/">Math</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/tensorflow/">Tensorflow</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://tailtq.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
