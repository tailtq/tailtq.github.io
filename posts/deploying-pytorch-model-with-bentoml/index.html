<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="BentoML - Tích hợp và triển khai PyTorch model ở local" /><meta name="author" content="Tai Le" /><meta property="og:locale" content="en_US" /><meta name="description" content="Giới thiệu" /><meta property="og:description" content="Giới thiệu" /><link rel="canonical" href="https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/" /><meta property="og:url" content="https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/" /><meta property="og:site_name" content="Tailtq" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-08T00:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="BentoML - Tích hợp và triển khai PyTorch model ở local" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Tai Le" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Tai Le"},"dateModified":"2022-08-07T23:49:43+07:00","datePublished":"2020-07-08T00:00:00+07:00","description":"Giới thiệu","headline":"BentoML - Tích hợp và triển khai PyTorch model ở local","mainEntityOfPage":{"@type":"WebPage","@id":"https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/"},"url":"https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/"}</script><title>BentoML - Tích hợp và triển khai PyTorch model ở local | Tailtq</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tailtq"><meta name="application-name" content="Tailtq"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-ZB7VQFD7XK"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZB7VQFD7XK'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-right"><div id="avatar"> <a href="/" alt="avatar"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Tailtq</a></div><div class="site-subtitle">A software developer who enjoys learning, reading, and building things</div></div><hr><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <span>Home</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <span>About me</span> </a><li class="nav-item"> <a href="/interesting-blogs/" class="nav-link"> <span>Interesting blogs</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <span>Archives</span> </a><li class="nav-item"> <a href="https://github.com/tailtq" class="nav-link" target="_blank"> <span>GitHub</span> </a><li class="nav-item}"> <a href="https://www.linkedin.com/in/tai-le-05124a187/" class="nav-link" target="_blank"> <span>Linkedin</span> </a></ul></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>BentoML - Tích hợp và triển khai PyTorch model ở local</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>BentoML - Tích hợp và triển khai PyTorch model ở local</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Tai Le </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 8, 2020, 12:00 AM +0700" prep="on" > Jul 8, 2020 <i class="unloaded">2020-07-08T00:00:00+07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 7, 2022, 11:49 PM +0700" prefix="Updated " > Aug 7, 2022 <i class="unloaded">2022-08-07T23:49:43+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1459 words">8 min</span></div></div><div class="post-content"><h3 id="giới-thiệu">Giới thiệu</h3><p>BentoML là một framework mã nguồn mở được xây dựng nhằm mục đích triển khai và chạy các model trên production một cách tiện lợi nhất. BentoML còn hỗ trợ những thư viện và framework phổ biến hiện nay như Scikit-Learn, PyTorch, Tensorflow, Keras và vv. Trong bài viết này, tôi sẽ hướng dẫn các bạn triển khai một model có sẵn ở local.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2020-07-08/bentoml-overview.png" alt="Overview" /></p><p>Dựa theo ảnh trên, sau khi xây dựng xong một model, BentoML sẽ chạy nó theo nhiều kiểu khác nhau, chẳng hạn như Docker Container, Restful API,… hoặc là triển khai trực tiếp lên các Cloud như Google Cloud Platform (GCP), Amazon Web Services (AWS), Azure như một hệ thống Microservices.</p><p>Theo tôi, điều này rất lý tưởng cho chúng ta, những Data Scientist và Machine Learning Practitioner có thể không có chuyên môn cao trong việc phát triển Server và DevOps, để dựng service cho model như một entry point hiệu quả.</p><p><strong>Tóm lại, BentoML có thể:</strong></p><ul><li>Tạo API chỉ bằng một số dòng code<li>Hỗ trợ các Machine Learning Framework phổ biến<li>Triển khai model với hiệu suất cao sử dụng adaptive micro-batching<li>Chạy model bằng nhiều cách khác nhau<li>Phối hợp triển khai linh hoạt với các best-practices của DevOps, hỗ trợ cả Docker và kiến trúc microservices</ul><h3 id="cách-tích-hợp">Cách tích hợp</h3><p>Hiện tại, tôi đã train sẵn một PyTorch model sử dụng tập dữ liệu CIFAR-10. Bây giờ công việc của tôi chỉ là tích hợp model này vào API, truy cập bằng Command Line Interface (CLI).</p><p>Ban đầu, chúng ta sẽ tạo <code class="language-plaintext highlighter-rouge">main.py</code>, chúng ta sẽ thực hiện thao tác deploy chủ yếu trên file này. Sau đó, hãy tham khảo kiến trúc model cho tập dữ liệu này.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">torch</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn.functional</span> <span class="k">as</span> <span class="n">F</span>


<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pool1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">MaxPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dropout1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout2d</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">conv3</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm3</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conv4</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm4</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pool2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">MaxPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dropout2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout2d</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">conv5</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm5</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conv6</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm6</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pool3</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">MaxPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dropout3</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout2d</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">256</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm7</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm1d</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dropout4</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">pool1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv3</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv4</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm4</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">pool2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv5</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm5</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv6</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm6</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">pool3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm7</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout4</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></table></code></div></div><p>Sau đó, nhiệm vụ tiếp theo là load lại model và build nó. Trong trường hợp các bạn đang train và có ý định dùng BentoML, các bạn cũng có thể dựa theo đoạn code bên dưới dòng comment <code class="language-plaintext highlighter-rouge"># Init BentoML</code> để lưu lại version mới nhất.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pytorch_image_classifier</span> <span class="k">as</span> <span class="n">PIC</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">PATH</span> <span class="o">=</span> <span class="s">'torch_scratch_cifar10_net.pth'</span>

    <span class="c1"># Tôi đang chạy bằng Macbook pro nên chỉ có CPU thôi :D
</span>    <span class="n">net</span> <span class="o">=</span> <span class="nc">Net</span><span class="p">()</span>
    <span class="n">net</span><span class="p">.</span><span class="nf">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">PATH</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nf">device</span><span class="p">(</span><span class="s">'cpu'</span><span class="p">)))</span>

    <span class="c1"># Khởi tạo BentoML
</span>    <span class="n">bento_svc</span> <span class="o">=</span> <span class="n">PIC</span><span class="p">.</span><span class="nc">PytorchImageClassifier</span><span class="p">()</span>
    <span class="n">bento_svc</span><span class="p">.</span><span class="nf">pack</span><span class="p">(</span><span class="s">'net'</span><span class="p">,</span> <span class="n">net</span><span class="p">)</span>

    <span class="c1"># Tạo Bento
</span>    <span class="n">saved_path</span> <span class="o">=</span> <span class="n">bento_svc</span><span class="p">.</span><span class="nf">save</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">'Finished Training:'</span><span class="p">,</span> <span class="n">saved_path</span><span class="p">)</span>
</pre></table></code></div></div><p>Có thể bạn sẽ thắc mắc rằng file <code class="language-plaintext highlighter-rouge">pytorch_image_classifier.py</code> được tạo lúc nào. Thực tế thì chưa, chúng ta sẽ tạo file này trong cùng folder với file <code class="language-plaintext highlighter-rouge">main.py</code>.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="kn">import</span> <span class="n">torch</span>
<span class="kn">from</span> <span class="n">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="n">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>

<span class="kn">import</span> <span class="n">bentoml</span>
<span class="kn">from</span> <span class="n">bentoml.artifact</span> <span class="kn">import</span> <span class="n">PytorchModelArtifact</span>
<span class="kn">from</span> <span class="n">bentoml.adapters</span> <span class="kn">import</span> <span class="n">ImageInput</span>

<span class="c1"># Tôi không chắc về dòng lệnh bên dưới, bạn có thể test xem nó có chạy hay không. Tuy nhiên dòng này là bắt buộc đối với Macbook, thiết bị mà tôi đang sử dụng
</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'KMP_DUPLICATE_LIB_OK'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'True'</span>

<span class="c1"># Đây là những lớp trong CIFAR-10, các lớp này sẽ được trả về sau khi gọi API hoặc chạy command line
</span><span class="n">classes</span> <span class="o">=</span> <span class="p">(</span><span class="s">'plane'</span><span class="p">,</span> <span class="s">'car'</span><span class="p">,</span> <span class="s">'bird'</span><span class="p">,</span> <span class="s">'cat'</span><span class="p">,</span>
           <span class="s">'deer'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'frog'</span><span class="p">,</span> <span class="s">'horse'</span><span class="p">,</span> <span class="s">'ship'</span><span class="p">,</span> <span class="s">'truck'</span><span class="p">)</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">device</span><span class="p">(</span><span class="s">'cuda:0'</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s">'cpu'</span><span class="p">)</span>

<span class="c1"># Định nghĩa hàm tăng cường dữ liệu cho ảnh trong giai đoạn test
</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">.</span><span class="nc">Compose</span><span class="p">([</span>
    <span class="n">transforms</span><span class="p">.</span><span class="nc">ToTensor</span><span class="p">(),</span>
    <span class="n">transforms</span><span class="p">.</span><span class="nc">Normalize</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Định nghĩa thư viện cần thiết cho model này
</span><span class="nd">@bentoml.env</span><span class="p">(</span><span class="n">pip_dependencies</span><span class="o">=</span><span class="p">[</span><span class="s">'torch'</span><span class="p">,</span> <span class="s">'Pillow'</span><span class="p">])</span>
<span class="c1"># Định nghĩa thuộc tính để truy cập tới model, thường ta sẽ dùng "net" cho PyTorch
</span><span class="nd">@bentoml.artifacts</span><span class="p">([</span><span class="nc">PytorchModelArtifact</span><span class="p">(</span><span class="s">'net'</span><span class="p">)])</span>
<span class="k">class</span> <span class="nc">PytorchImageClassifier</span><span class="p">(</span><span class="n">bentoml</span><span class="p">.</span><span class="n">BentoService</span><span class="p">):</span>
    <span class="c1"># Định nghĩa loại dữ liệu bạn sẽ truyền lên, trong trường hợp này đầu vào sẽ là một ảnh
</span>    <span class="nd">@bentoml.api</span><span class="p">(</span><span class="n">ImageInput</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Truy cập thuộc tính "net" và thiết lập trạng thái đánh giá (evaluation mode)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">artifacts</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
        <span class="n">input_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nf">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">).</span><span class="nf">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="n">input_data</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">transform</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">artifacts</span><span class="p">.</span><span class="nf">net</span><span class="p">(</span><span class="nc">Variable</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">stack</span><span class="p">(</span><span class="n">input_data</span><span class="p">)).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">output_classes</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">classes</span><span class="p">[</span><span class="n">output_class</span><span class="p">]</span> <span class="k">for</span> <span class="n">output_class</span> <span class="ow">in</span> <span class="n">output_classes</span><span class="p">]</span>

</pre></table></code></div></div><p>Tiếp theo, chúng ta sẽ chạy lệnh <code class="language-plaintext highlighter-rouge">python main.py</code>. Kết quả cho ra sẽ là một Bento (nghe như ẩm thực Nhật Bản vậy). Tôi nghĩ tên này có nghĩa khác là package (hoặc là container trong Docker).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2020-07-08/bento.jpg" alt="Bento" /></p><p>Log sẽ được in ra như bên dưới:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[2020-07-08 17:02:56,350] INFO - BentoService bundle 'PytorchImageClassifier:20200708170229_EE710E' saved to: /Users/tailtq/bentoml/repository/PytorchImageClassifier/20200708170229_EE710E
Finished Training: /Users/tailtq/bentoml/repository/PytorchImageClassifier/20200708170229_EE710E
</pre></table></code></div></div><p>Thay vì dùng <code class="language-plaintext highlighter-rouge">bento_svc.save()</code> để lưu vào thư mục mặc định của BentoML, chúng ta còn có thể lưu vào bất cứ đâu khi sử dụng hàm <code class="language-plaintext highlighter-rouge">save_to_dir(path)</code>.</p><p>Vậy là oke rồi! Chúng ta đã tích hợp BentoML vào model, bây giờ là lúc để tận hưởng nổ lực của chúng ta.</p><h3 id="những-cách-để-thưởng-thức-bento-của-chúng-ta">Những cách để “thưởng thức” Bento của chúng ta:</h3><h4 id="1-sử-dụng-restful-api">1. Sử dụng Restful API:</h4><p>Chúng ta có thể build 1 bộ API ngay lập tức bằng lệnh bên dưới:</p><p><code class="language-plaintext highlighter-rouge">bentoml serve PytorchImageClassifier:latest</code></p><p>với <code class="language-plaintext highlighter-rouge">PytorchImageClassifier</code> là <code class="language-plaintext highlighter-rouge">class</code> và <code class="language-plaintext highlighter-rouge">latest</code> là phiên bản. Bạn cũng có thể thay đổi <code class="language-plaintext highlighter-rouge">latest</code> với một version cụ thể nào đó, chẳng hạn như <code class="language-plaintext highlighter-rouge">20200708170229_EE710E</code>, để so sánh hiệu suất giữ phiên bản cũ và mới hơn.</p><p>Mặc định, BentoML sử dụng thư mục được định trước để tải model. Nếu bạn sử dụng hàm <code class="language-plaintext highlighter-rouge">save_to_dir</code>, bạn phải nhập thêm đường dẫn đến model đó, ví dụ như <code class="language-plaintext highlighter-rouge">/my/path/PytorchImageClassifier:version</code>.</p><p>Dưới đây là lệnh của tôi:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2020-07-08/restful-api-command.png" alt="Restful API command" /></p><p>Đặc biệt là API cũng có Swagger:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2020-07-08/swagger-api-interface.png" alt="API" /></p><h4 id="2-sử-dụng-cli">2. Sử dụng CLI:</h4><p>Đây là lúc chúng ta sử dụng CLI:</p><p><code class="language-plaintext highlighter-rouge">bentoml run PytorchImageClassifier:latest predict --input="dog-puppy-on-garden-royalty.jpg"</code></p><p>Lưu ý: Tôi cố ý cắt ngắn bớt đường dẫn của input để nhìn gọn hơn.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2020-07-08/cli-result.png" alt="CLI result" /></p><p>Model này được huấn luyện từ đầu và đạt được độ chính xác khoảng 85% trong tập <code class="language-plaintext highlighter-rouge">validation set</code>. Do đó kết quả chắc hẳn sẽ là <code class="language-plaintext highlighter-rouge">dog</code>.</p><h4 id="3-sử-dụng-model-trong-code">3. Sử dụng model trong code:</h4><p>Theo hướng tiếp cận này, chúng ta sẽ tải model trực tiếp bằng Python code.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>

<span class="n">bento_svc</span> <span class="o">=</span> <span class="n">bentoml</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'/my/path/PytorchImageClassifier/20200708170229_EE710E'</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'dog-puppy-on-garden-royalty.jpg'</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">bento_svc</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></table></code></div></div><p>Bên cạnh đó, chúng ta cũng có thể container hoá cho từng phiên bản và đẩy lên Dockerhub. Làm cách này, các thiết bị và server khác có thể được hưởng lợi.</p><h3 id="tổng-kết">Tổng kết</h3><p>Chúng ta vừa trải nghiệm một công cụ tiện lợi cho Data Scientist và Machine Learning Practitioner, những người có thể không quen với phát triển ứng dụng server hoặc DevOps. Đồng thời BentoML cũng cho chúng ta thấy cách mà model chạy trên môi trường production.</p><p>Mặc dù vậy, nó vẫn còn những hạn chế. Trong những ứng dụng yêu cầu performance cao và tối ưu hơn, thì chúng ta cần phải dựng model trong môi trường Native, như Android hoặc iOS.</p><p>Trong tương lai, tôi sẽ đào sâu hơn vào framework để hiểu được BentoML thực sự hoạt động như thế nào và thử nghiệm <code class="language-plaintext highlighter-rouge">Micro Batching</code>, phần mà tôi chưa nhắc đến trong bài viết này.</p><p>Cảm ơn các bạn đã đọc bài viết này và hãy tiếp tục nghiên cứu nhé :D.</p><h3 id="tài-liệu">Tài liệu</h3><p><a href="https://docs.bentoml.org/en/latest/">[1] BentoML homepage</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >Python</a> <a href="/tags/ai/" class="post-tag no-text-decoration" >AI</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >DevOps</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=BentoML - Tích hợp và triển khai PyTorch model ở local - Tailtq&url=https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=BentoML - Tích hợp và triển khai PyTorch model ở local - Tailtq&u=https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=BentoML - Tích hợp và triển khai PyTorch model ở local - Tailtq&url=https://tailtq.github.io/posts/deploying-pytorch-model-with-bentoml/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/asynchronous-programming/">Asynchronous Programming</a><li><a href="/posts/streamlit-a-fast-way-to-build-web-applications/">Streamlit - A Fast Way to Build Web Applications</a><li><a href="/posts/modify-facebook-duckling/">Modify Facebook's Duckling</a><li><a href="/posts/tensorflow-with-amd-ubuntu/">Use Tensorflow with AMD GPU on Ubuntu</a><li><a href="/posts/how-i-reduced-rasa-testing-time-by-60-80/">How I reduced RASA testing time by 60-80%</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/back-end/">Back-end</a> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/front-end/">Front-end</a> <a class="post-tag" href="/tags/haskell/">Haskell</a> <a class="post-tag" href="/tags/math/">Math</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/tensorflow/">Tensorflow</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/how-i-reduced-rasa-testing-time-by-60-80/"><div class="card-body"> <span class="timeago small" > Aug 6, 2022 <i class="unloaded">2022-08-06T00:00:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I reduced RASA testing time by 60-80%</h3><div class="text-muted small"><p> It is quite a long time since I wrote my latest post, and now I come back stronger with a topic that contains both Back-end and AI. It is my journey to customize the Natural Language Understanding ...</p></div></div></a></div><div class="card"> <a href="/posts/tensorflow-with-amd-ubuntu/"><div class="card-body"> <span class="timeago small" > Apr 21, 2020 <i class="unloaded">2020-04-21T00:00:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Use Tensorflow with AMD GPU on Ubuntu</h3><div class="text-muted small"><p> After I received my graphic card (Radeon RX 570 Series) from my cousin. So I started using Tensorflow and found out my training process was also extremely slow, like when training with my MacOS...</p></div></div></a></div><div class="card"> <a href="/posts/cat-and-dog-recognition-using-keras/"><div class="card-body"> <span class="timeago small" > Apr 26, 2020 <i class="unloaded">2020-04-26T00:00:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cat & dog recognition using Keras</h3><div class="text-muted small"><p> For Machine Learning beginners who just know about basic agorithms and want more - get involved in Computer Vision projects, cat &amp; dog recognition is a fairly straightforward problem that e...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cat-and-dog-recognition-using-keras/" class="btn btn-outline-primary" prompt="Older"><p>Cat & dog recognition using Keras</p></a> <a href="/posts/region-based-convolutional-neural-network/" class="btn btn-outline-primary" prompt="Newer"><p>R-CNN - Region-based Convolutional Neural Network</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Tai Le</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/back-end/">Back end</a> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/front-end/">Front end</a> <a class="post-tag" href="/tags/haskell/">Haskell</a> <a class="post-tag" href="/tags/math/">Math</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/tensorflow/">Tensorflow</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://tailtq.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
